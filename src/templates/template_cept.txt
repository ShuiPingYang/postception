<?php

use Helper\Api;

class ApiCest
{

    /**
     * @inheritdoc
     * @param ApiTester $I
     */
    public $cookie;

    public function _before(ApiTester $I)
    {
        $session = json_decode(file_get_contents(__DIR__ . '/../sess_' . Api::LOGIN_USER_SESSION), true); //设置session id
        // $session = json_decode(file_get_contents('D:\WWW\anyu-portal\tests\sess_' . Api::LOGIN_USER_SESSION), true); //设置session id
        if (session_status() !== PHP_SESSION_ACTIVE) {
            session_id(Api::LOGIN_USER_SESSION); //设置session id
            session_start();
        }
        foreach ($session as $key => $value) {
            $_SESSION[$key] = $value;
        }
        // 让之前的session_id得以正常使用
        session_regenerate_id();
        $I->haveInRedis('string', 'CODECEPTION_PHPSESSID', Api::LOGIN_USER_SESSION);
        $this->cookie = 'PHPSESSID=' . $I->grabFromRedis('CODECEPTION_PHPSESSID');
    }

    %methods%
